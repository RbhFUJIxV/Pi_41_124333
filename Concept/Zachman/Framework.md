# Матрица Захмана для системы "Визуальная новелла с динамическим AI-повествованием"


| Перспектива | **Что? (Данные)** | **Как? (Функция)** | **Где? (Местоположение)** | **Кто? (Люди/Роли)** | **Когда? (Время)** | **Зачем? (Мотивация)** |
|-------------|-------------------|-------------------|--------------------------|----------------------|-------------------|------------------------|
| **Контекстная (Scope)** | Динамически генерируемые истории, диалоги, персонажи, сеттинги, изображения | Цифровая интерактивная игра, сочетающая предопределённые сценарии с AI-генерацией | Устройство пользователя (ПК), локальная файловая система, облачные API | Игрок (пользователь), разработчик, издатель | Время игры (сессии), время разработки, время генерации контента | Создание уникального, адаптивного и персонализированного игрового опыта; снижение стоимости производства контента |
| **Концептуальная (Business Concepts)** | Сущности: История, Персонаж, Диалог, Сцена, Изображение; Метаданные: Контекст, Настройки, Состояние игры | Процессы: Начало новой игры, Генерация продолжения, Ввод пользователя, Сохранение/загрузка, Генерация изображений | Логические модули: Ядро игры, Генератор текста, Генератор изображений, Менеджер данных | Роли: Игрок (автор/читатель), Система (генератор), Разработчик (создатель) | Игровые циклы, Циклы генерации контента, События сохранения | Понять бизнес-сущности и процессы, обеспечивающие ценность для пользователя |
| **Логическая (System Logic)** | Структуры данных: JSON-промпты, объекты персонажей, история диалогов в БД, кэшированные ресурсы | Архитектурные компоненты: Движок RenPy, API Gateway, LLM Dispatcher, Менеджер данных, База SQLite | Логическое размещение: Клиентское приложение, Внешние сервисы, Локальные файлы | Логические акторы: Игровой клиент, Сервисы AI, База данных | Последовательность вызовов: Пользовательский ввод → Генерация → Отображение → Сохранение | Определить логическую структуру системы без привязки к технологиям |
| **Технологическая (Technology)** | Форматы: SQLite таблицы, JSON файлы, PNG/JPEG изображения, текстовые файлы сценариев (.rpy) | Технологии: Python, RenPy, SQLite, HTTP/REST API, asyncio, aiosqlite, библиотеки для работы с AI | Физическое размещение: Локальный компьютер игрока, Облачные сервисы (OpenAI, Yandex Cloud), Локальный сервер (Ollama, ComfyUI) | Технические роли: Веб-клиент, Локальный процесс, Внешний API-сервер | Время выполнения: HTTP-запросы, время генерации модели, задержки сети | Выбрать конкретные технологии и инструменты для реализации логической архитектуры |
| **Детальная (Detailed Representation)** | Схемы БД: таблицы sessions, dialogs, resources; Форматы промптов: системный промпт + история + пользовательский ввод | Код: Классы LLMDispatcher, BaseLLMAdapter, PromptBuilder, SQL-запросы, обработчики ошибок, конфигурационные файлы | Конфигурации сети: URL эндпоинтов, настройки прокси, параметры SSL; Пути к локальным файлам: ./game/, ./cache/, ./generated/ | Детали реализации: Потоки выполнения, процессы, соединения с БД, сессии HTTP | Тайминги: Таймауты запросов, интервалы повторов, время жизни кэша, расписание автосохранения | Предоставить детали, необходимые для построения и конфигурации системы |
| **Функционирующая система (Functioning System)** | Реальные данные: сохранённые игры игроков, сгенерированные тексты и изображения, логи работы | Работающее приложение: Скомпилированная игра, запущенные процессы, активные соединения с API | Физическая инфраструктура: Конкретный компьютер пользователя, используемые облачные регионы, состояние сети | Действующие лица: Конкретный игрок, работающие экземпляры сервисов, операционная система | Реальное время: Длительность игровых сессий, фактическое время отклика API, время загрузки | Реализованная система, используемая по назначению, соответствующая всем предыдущим перспективам |

